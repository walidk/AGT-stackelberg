\input{packages.tex}
\input{commands}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage[utf8]{inputenc}
%\usepackage[french]{babel}
\usepackage{graphicx}
\usepackage{hyperref}
\hypersetup{bookmarks=false, pdfborder={0 0 0}, colorlinks=true, linktoc=all}


\title{Stackelberg strategies for transportation networks}
%\author{Walid Krichene}
\date{\today}


\begin{document}
\maketitle


%#########################################################################################################################
\begin{abstract}
We study inefficiencies of transportation networks due to the selfish behaviour of drivers, by comparing social optimal equilibria to Nash equilibria. Then we investigate possible strategies to reduce the inefficiency by studying the Stackelberg routing game: assuming we have control over a fraction of the flow on the network, what is a good way of routing that compliant flow so that the induced Nash equilibrium is closer to the social optimum than the initial Nash equilibrium? Stackelberg scheduling on parallel link networks has been studied in a non-transportation setting, and it is shown in ~\cite{rou01} that computing the optimal Stackelberg assignment is NP-hard in the number of links. Approximate polynomial time strategies such as Largest Latency First are proposed and bounds on the inefficiency are shown for those strategies.
We first describe the problem in the specific setting of transportation networks, where the dynamics of flow result in latency functions that do not satisfy common properties assumed in the literature studying Stackelberg scheduling. We then characterize Nash equilibria for our network and show that there are multiple such equilibria. Then we study the Stackelberg game and describe optimal Stackelberg strategy in the case of 2 link networks, and show results for general parallel link networks.
\end{abstract}


%#########################################################################################################################
\section{The Model}
\subsection{Traffic flows}
We consider a network of $N$ parallel links indexed by $n \in \{1, \dots, N \}$, under constant positive flow demand, or rate $r$. The flow $q_n$ on link $n$ is a function of the density $\rho_n$, given by a triangular fundamental diagram with the following parameters
\begin{itemize}
\item $v_n$ the free-flow speed on the link
\item $w_n$ the congestion wave speed
\item $q_n^{\max}$ the maximum capacity of the link
\end{itemize}
In the free flow regime (when the density on the link is less than a critical density $\rho_n^c$ that is given by $v_n\rho_n^c = q_n^{\max}$) the velocity is constant and the flow increases linearly in the density $q_n = v_n \rho_n$. In the congested regime ($\rho_n > \rho_n^c$), the flow decreases linearly in the density $q_n = q_n^{\max} - w_n(\rho_n - \rho_n^c)$ and the velocity is decreasing.

\begin{align*}
q_n = 
\begin{cases}
v_n \rho_n & \rho_n \leq \rho_n^c\\
q_n^{\max} - w_n(\rho_n - \rho_n^c) & \rho_n > \rho_n^c
\end{cases}
\end{align*}

We denote by $(N, r)$ a network instance with $N$ links and rate $r$. We define a feasible flow assignment $q$ as

\begin{definition}
A flow assignment $q \in \mathbb{R}_+^N$ is feasible for instance $(N, r)$ if $\forall n$ $q_n \leq q_n^{\max}$ and $\sum_n q_n = r$
\end{definition}

\subsection{Steady state equilibria}
We are interested in the steady state equilibria of the network under constant positive rate $r$. In the steady state equilibria the flow and density variables are static.

\subsection{Latency function}
The velocity on link $n$ is given by $q_n/\rho_n$, and the individual latency function is
\[
l_n(\rho_n) = \frac{L_n\rho_n}{q_n} 
\]

where $L_n$ is the length of link $n$.
Note that $l_n$ is an increasing function of density, but not of flow. We can express the latency as a function of flow by introducing an integer $m_n \in \{0, 1\}$ that specifies whether link $n$ is congested ($m_n = 1$ if $n$ is congested and $m_n = 0$ if $n$ is free-flow)
\[
\rho_n(q_n, m_n) = m_n \left( \rho_n^c + \frac{q_n^{\max} - q_n}{w_n} \right) + (1-m_n)\frac{q_n}{v_n}
\]
this corresponds to inverting the fundamental diagram that gives the flow as a function of density. The latency is then given by
\[
l_n(q_n, m_n) = \frac{L_n}{q_n} \left( m_n \left( \rho_n^c + \frac{q_n^{\max} - q_n}{w_n} \right) + (1-m_n)\frac{q_n}{v_n} \right)
\]

The total latency incurred by all users on a link is $q_n l_n(\rho_n) = L_n \rho_n$, and the total latency incurred by all users on the network is
\[
C(\rho) = \sum_n L_n \rho_n = L^T\rho
\]

\paragraph{Note} The latency function does not satisfy properties usually assumed in the Stackelberg scheduling literature. In particular, the latency $l_n(q_n)$ is not an increasing function of flow: it is a constant function if the link is in free-flow, and a \emph{decreasing} function when the link is congested.
\begin{align*}
l_n(q_n, 0) &= \frac{L_n}{v_n}\\
l_n(q_n, 1) &= L_n \left( \rho_n^c + \frac{1}{w_n}(\frac{q_n^{\max}}{q_n} - 1) \right)
\end{align*}

As a consequence, some of the known results on congestion networks do not apply to our setting: for instance, the network has multiple Nash equilibria that have different costs. In the next section we specify this result and address the issue of having multiple pure Nash equilibria.



%#########################################################################################################################
\section{Nash Equilibria}
In this section we characterize pure Nash equilibria of the network, which we simply refer to as Nash equilibria. We first review the essential uniqueness of Nash equilibria in the case of increasing latency functions (in the sense that all Nash equilibria have the same cost). Then we show that latency functions consistent with the fundamental diagram of traffic induce multiple Nash equilibria with different costs, and we analytically solve for Nash equilibria for $(N = 2, r)$ instances, and give some results describing Nash equilibria for $(N>2, r)$ instances.

\subsection{Characterization of Nash equilibria}

\begin{definition}
An assignment $(q, m)$ for instance $(N, r)$ is at Nash equilibrium if $\forall n$
\[
q_n > 0 \Rightarrow \forall k, l_n(q_n, m_n) \leq l_k(q_k, m_k)
\]
\end{definition}

In particular, every (non-atomic) user cannot improve her latency by switching to another link. As a consequence, all links that are in the support of $q$ have the same latency $l_0$, and links that are not in the support have latency greater than $l_0$. Note that to fully characterize the equilibrium one needs to specify the congestion state $m$, since the latency on a link depends on whether the link is congested.

\begin{lemma}
\label{lemma:nash_eq}
If $(q, m)$ is an assignment for instance $(N, r)$ at Nash equilibrium, then
\begin{align*}
q_n >0 &\Rightarrow l_n(q_n, m_n) = l_0\\
q_n = 0 &\Rightarrow l_n(0, 0) \geq l_0
\end{align*}
and the total latency incurred by the network is $C(q) = r l_0$.
\end{lemma}

Note that links that have zero flow are necessarily in free-flow $q_n = 0 \Rightarrow m_n = 0$.

\subsection{Nash equilibria for increasing latency functions}
Assuming the latency functions $l_n(q_n)$ are increasing, one can show that all Nash equilibria have the same cost. Let $q$ and $q'$ be two assignments for $(N, r)$ at Nash equilibrium. Let $l_0$, respectively $l'_0$ denote the common latency of all links in the support of $q$, respectively $q'$. The cost of the Nash equilibria are respectively $rl_0$ and $rl'_0$.

Let $n$ be in the support of $q$, and $n'$ in the support of $q'$. Then since $q$ is at Nash equilibrium, $l_n(q_n) \leq l_{n'}(0)$ and since $l_{n'}$ is increasing $l_{n'}(0) \leq l_{n'}(q'_{n'})$. Thus $l_0 = l_n(q_n) \leq l_{n'}(q_{n'}) = l'_0$. Now permuting the roles of $q$ and $q'$ yields $l'_0 \leq l_0$. Therefore $l_0 = l'_0$ and both equilibria have the same cost.

\subsection{Traffic networks have multiple Nash equilibria}


\subsection{Nash equilibria for 2-parallel link networks}
We consider a $(2, r)$ instance.


\subsection{Pure Nash equilibria for general parallel link networks}
We consider a $(N, r)$ instance where $N \geq 2$.


%#########################################################################################################################
\section{Social Optimal equilibria}


%#########################################################################################################################
\section{Stackelberg assignment}
In order to reduce the inefficiency of the network, we assume that a fraction of the flow is centrally controlled, and we investigate possible strategies for improving the equilibria of the network. 

We consider the following problem: given a network under constant flow demand $r$, assume we have control over a fraction $\beta$ of the flow: the corresponding users are compliant and willing to change their routes according to our instructions. We assign the compliant flow $\beta r$ according to a Stackelberg strategy defined as follows

\begin{definition}
A Stackelberg strategy is an assignment $s$ of the compliant flow $\beta r$ that is feasible for the instance $(N, \beta r)$.
\end{definition}

i.e. assignment $s$ satisfies $s_n \leq q_n^{\max} \forall n$ and $\sum_n s_n = \beta r$). 
We assume that the non compliant users, with corresponding flow $(1-\beta)r$, will choose their routes selfishly after the Stackelberg assignment $s$ of compliant users is revealed. This induces an assignment $t$ of the selfish flow at Nash equilibrium. To characterize this equilibrium, which we refer to as the induced equilibrium, we first assume that the flows of compliant users at equilibrium are indeed the flows defined by the revealed Stackelberg strategy $s$. Then the total flow on the link $n$ is simply $s_n + t_n$ and the induced equilibrium satisfies $\forall n$
\[
t_n > 0 \Rightarrow \forall k, l_n(s_n + t_n, m_n) \leq l_k(s_k + t_k, m_k)
\]
and by lemma~\ref{lemma:nash_eq}, all links that are used by selfish users have a common latency $l_0$ in the induced equilibrium, and links that are not used by the selfish flow have latency greater than $l_0$. Formally, let $T = \{n | t_n >0\}$ denote the set of links used by the non compliant flow and $T^c = \{n | t_n = 0\}$. Then
\begin{align*}
\forall n \in T,\, &l_n(s_n + t_n, m_n) = l_0 \\
\forall n \in T^c,\, &l_n(s_n, m_n) \geq l_0
\end{align*}

\subsection{Valid Stackelberg assignments}

The non compliant flows at induced equilibrium may be less than the flow $s_n$ prescribed by the Stackelberg strategy. To see this, consider a simple 2 link network where links have the same length $L_1 = L_2 = 1$, link 1 has greater free-flow speed and capacity than link $2$ $v_1 > v_2$, $q_1^{\max} > q_2^{\max}$, and both links have same congestion wave speed $w_1 = w_2$.
Now assume that the network is subject to flow demand $r = q_1^{\max} + \epsilon$ and most of the flow is compliant $\alpha r = f_1^{\max}$. Consider the following Stackelberg strategy: $s_1 = q_1^{\max}$ and $s_2 = 0$.
In the induced equilibrium, both links are used since the total flow demand $r$ is greater than the capacity of a single link. 





%#########################################################################################################################
\section{Optimal Stackelberg equilibrium}

\subsection{The 2-link case}

\subsection{General case}



\section{Approximate strategies}


%#########################################################################################################################
\begin{thebibliography}{8}

\bibitem{pap10}
  C. Papadimitriou and G. Valiant. A new Look at Selfish Routing. In
  \emph{Innovations in Computer Science, 2010}.

\bibitem{rou01}
	T. Roughgarden. Stackelberg Scheduling Strategies. In \emph{Proceedings of the 33rd Annual ACM Symposium on the Theory of Computing, 2001}

\end{thebibliography}

\end{document}